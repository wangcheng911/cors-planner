define(["require","exports","module","model/modules","util/store"],function(e,t){function s(){r.populate(i.get(planner.list.modules)||[])}function o(){i.set(planner.list.modules,r.toJSON())}var n=e("model/modules"),r=new n(planner.list.modules),i=e("util/store");t.init=function(){setTimeout(function(){s()},190)},$.subscribe("module:save",function(){o()}),$.subscribe("module:add",function(e,t){r.add(t)}),$.subscribe("module:sequence",function(e,t){r.inSequence(t),o()}),$.subscribe("module:share",function(){var e=r.compress(),t=[],n,i=e.length;for(n=0;n<i;n++)t.push(e[n].id+"|"+(e[n].visible?1:0)+"|"+JSON.stringify(e[n].allocated));$.publish("app:share:get",[t.join("&")])}),$.subscribe("module:readFromShare",function(e,t){var n,i=t.length,s;for(n=0;n<i;n++)s=t[n].split("|"),r.add(s[0],null,{visible:s[1]==="1",allocated:JSON.parse(s[2])})}),$.subscribe("module:preview",function(e,t){var n=r.get(t);n&&$.publish("module:detail",n)}),$.subscribe("module:remove",function(e,t){var n=r.remove(t);n&&$.publish("message:success","Module "+n.get("code")+" is removed")}),$.subscribe("module:clean",function(){r.clean(),$.publish("module:clean:all"),$.publish("message:success","All modules are removed")})});