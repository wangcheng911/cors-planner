define(["require","exports","module","api/yql"],function(e,t){function u(t,s){!i||!r?e(["school/"+planner.school+"/url","school/"+planner.school+"/parser"],function(e,o){r=o,i=new n(e),a(t,s,0)}):a(t,s,0)}function a(e,t,n){if(n===0){if(s[e])return;s[e]=!0,$.publish("module:fetching",e)}else if(n===o){$.publish("module:"+e+":fetched"),$.publish("message:error","Fetching data for Module "+e+" failed, Please try again later.");return}i.requestModule(e,function(i){var o,u=!0;try{o=r.parse(i),o!==null?o.isAvailable?t(o):$.publish("message:error","Module "+e+" is not available now."):(u=!1,a(e,t,n+1))}catch(f){$.publish("message:error",f.toString())}u&&(delete s[e],$.publish("module:"+e+":fetched"))})}var n=e("api/yql"),r,i,s={},o=3;$.subscribe("app:school",function(){r=null,i=null}),t.crawl=u});