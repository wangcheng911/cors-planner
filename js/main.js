(function(){function u(){try{return r in t&&t[r]}catch(e){return!1}}function a(){try{return i in t&&t[i]&&t[i][t.location.hostname]}catch(e){return!1}}var e={},t=window,n=t.document,r="localStorage",i="globalStorage",s="__storejs__",o;e.disabled=!1,e.set=function(e,t){},e.get=function(e){},e.remove=function(e){},e.clear=function(){},e.transact=function(t,n,r){var i=e.get(t);r==null&&(r=n,n=null),typeof i=="undefined"&&(i=n||{}),r(i),e.set(t,i)},e.getAll=function(){},e.serialize=function(e){return JSON.stringify(e)},e.deserialize=function(e){return typeof e!="string"?undefined:JSON.parse(e)};if(u())o=t[r],e.set=function(t,n){if(n===undefined)return e.remove(t);o.setItem(t,e.serialize(n))},e.get=function(t){return e.deserialize(o.getItem(t))},e.remove=function(e){o.removeItem(e)},e.clear=function(){o.clear()},e.getAll=function(){var t={};for(var n=0;n<o.length;++n){var r=o.key(n);t[r]=e.get(r)}return t};else if(a())o=t[i][t.location.hostname],e.set=function(t,n){if(n===undefined)return e.remove(t);o[t]=e.serialize(n)},e.get=function(t){return e.deserialize(o[t]&&o[t].value)},e.remove=function(e){delete o[e]},e.clear=function(){for(var e in o)delete o[e]},e.getAll=function(){var t={};for(var n=0;n<o.length;++n){var r=o.key(n);t[r]=e.get(r)}return t};else if(n.documentElement.addBehavior){var f,l;try{l=new ActiveXObject("htmlfile"),l.open(),l.write('<script>document.w=window</script><iframe src="/favicon.ico"></frame>'),l.close(),f=l.w.frames[0].document,o=f.createElement("div")}catch(c){o=n.createElement("div"),f=n.body}function h(t){return function(){var n=Array.prototype.slice.call(arguments,0);n.unshift(o),f.appendChild(o),o.addBehavior("#default#userData"),o.load(r);var i=t.apply(e,n);return f.removeChild(o),i}}var p=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function d(e){return e.replace(p,"___")}e.set=h(function(t,n,i){n=d(n);if(i===undefined)return e.remove(n);t.setAttribute(n,e.serialize(i)),t.save(r)}),e.get=h(function(t,n){return n=d(n),e.deserialize(t.getAttribute(n))}),e.remove=h(function(e,t){t=d(t),e.removeAttribute(t),e.save(r)}),e.clear=h(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(r);for(var n=0,i;i=t[n];n++)e.removeAttribute(i.name);e.save(r)}),e.getAll=h(function(t){var n=t.XMLDocument.documentElement.attributes;t.load(r);var i={};for(var s=0,o;o=n[s];++s)i[o]=e.get(o);return i})}try{e.set(s,s),e.get(s)!=s&&(e.disabled=!0),e.remove(s)}catch(c){e.disabled=!0}e.enabled=!e.disabled,typeof module!="undefined"&&typeof module!="function"?module.exports=e:typeof define=="function"&&define.amd?define("util/store",e):this.store=e})(),define("global",["require","exports","module","util/store"],function(e,t){var n=e("util/store"),r=["key","user","status"];(function(){var t=Function,i=(new t("return this"))();i.planner||(i.planner={}),planner.version="0.8.0",planner.school=n.get("app:school")||null,planner.list={modules:"modules",previews:"previews"},planner.weekDays=["MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],planner.slotPopover=n.get("app:slotPopover")||!0,planner.slotType=n.get("app:slotType")||"location",planner.get=function(e){return this[e]},planner.set=function(e,t){$.inArray(e,r)===-1&&(this[e]=t,n.set("app:"+e,t),$.publish("app:"+e,[t]))},planner.loadCss=function(e){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e,document.getElementsByTagName("head")[0].appendChild(t),planner.trackEvent("load-css",e)},planner.analytics=function(){i._gaq&&i._gaq.push($.makeArray(arguments))},planner.trackEvent=function(e,t){planner.analytics("_trackEvent",e,t,planner.school)},planner.trackPageView=function(e,t){planner.analytics("_trackPageview",t?t+"="+e:e)}})()}),!function(e){e(function(){e.support.transition=function(){var e=function(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},n;for(n in t)if(e.style[n]!==undefined)return t[n]}();return e&&{end:e}}()})}(window.jQuery),!function(e){var t=function(t,n){this.options=n,this.$element=e(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",e.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};t.prototype={constructor:t,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var t=this,n=e.Event("show");this.$element.trigger(n);if(this.isShown||n.isDefaultPrevented())return;e("body").addClass("modal-open"),this.isShown=!0,this.escape(),this.backdrop(function(){var n=e.support.transition&&t.$element.hasClass("fade");t.$element.parent().length||t.$element.appendTo(document.body),t.$element.show(),n&&t.$element[0].offsetWidth,t.$element.addClass("in").attr("aria-hidden",!1).focus(),t.enforceFocus(),n?t.$element.one(e.support.transition.end,function(){t.$element.trigger("shown")}):t.$element.trigger("shown")})},hide:function(t){t&&t.preventDefault();var n=this;t=e.Event("hide"),this.$element.trigger(t);if(!this.isShown||t.isDefaultPrevented())return;this.isShown=!1,e("body").removeClass("modal-open"),this.escape(),e(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),e.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal()},enforceFocus:function(){var t=this;e(document).on("focusin.modal",function(e){t.$element[0]!==e.target&&!t.$element.has(e.target).length&&t.$element.focus()})},escape:function(){var e=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(t){t.which==27&&e.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var t=this,n=setTimeout(function(){t.$element.off(e.support.transition.end),t.hideModal()},500);this.$element.one(e.support.transition.end,function(){clearTimeout(n),t.hideModal()})},hideModal:function(e){this.$element.hide().trigger("hidden"),this.backdrop()},removeBackdrop:function(){this.$backdrop.remove(),this.$backdrop=null},backdrop:function(t){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=e.support.transition&&r;this.$backdrop=e('<div class="modal-backdrop '+r+'" />').appendTo(document.body),this.options.backdrop!="static"&&this.$backdrop.click(e.proxy(this.hide,this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),i?this.$backdrop.one(e.support.transition.end,t):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,e.proxy(this.removeBackdrop,this)):this.removeBackdrop()):t&&t()}},e.fn.modal=function(n){return this.each(function(){var r=e(this),i=r.data("modal"),s=e.extend({},e.fn.modal.defaults,r.data(),typeof n=="object"&&n);i||r.data("modal",i=new t(this,s)),typeof n=="string"?i[n]():s.show&&i.show()})},e.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},e.fn.modal.Constructor=t,e(function(){e("body").on("click.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),r=n.attr("href"),i=e(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=i.data("modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},i.data(),n.data());t.preventDefault(),i.modal(s).one("hide",function(){n.focus()})})})}(window.jQuery),!function(e){function r(){i(e(t)).removeClass("open")}function i(t){var n=t.attr("data-target"),r;return n||(n=t.attr("href"),n=n&&/#/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,"")),r=e(n),r.length||(r=t.parent()),r}var t="[data-toggle=dropdown]",n=function(t){var n=e(t).on("click.dropdown.data-api",this.toggle);e("html").on("click.dropdown.data-api",function(){n.parent().removeClass("open")})};n.prototype={constructor:n,toggle:function(t){var n=e(this),s,o;if(n.is(".disabled, :disabled"))return;return s=i(n),o=s.hasClass("open"),r(),o||(s.toggleClass("open"),n.focus()),!1},keydown:function(t){var n,r,s,o,u,a;if(!/(38|40|27)/.test(t.keyCode))return;n=e(this),t.preventDefault(),t.stopPropagation();if(n.is(".disabled, :disabled"))return;o=i(n),u=o.hasClass("open");if(!u||u&&t.keyCode==27)return n.click();r=e("[role=menu] li:not(.divider) a",o);if(!r.length)return;a=r.index(r.filter(":focus")),t.keyCode==38&&a>0&&a--,t.keyCode==40&&a<r.length-1&&a++,~a||(a=0),r.eq(a).focus()}},e.fn.dropdown=function(t){return this.each(function(){var r=e(this),i=r.data("dropdown");i||r.data("dropdown",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.dropdown.Constructor=n,e(function(){e("html").on("click.dropdown.data-api touchstart.dropdown.data-api",r),e("body").on("click.dropdown touchstart.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.dropdown.data-api touchstart.dropdown.data-api",t,n.prototype.toggle).on("keydown.dropdown.data-api touchstart.dropdown.data-api",t+", [role=menu]",n.prototype.keydown)})}(window.jQuery),!function(e){var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.attr("data-target"),i,s,o;r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));if(t.parent("li").hasClass("active"))return;i=n.find(".active a").last()[0],o=e.Event("show",{relatedTarget:i}),t.trigger(o);if(o.isDefaultPrevented())return;s=e(r),this.activate(t.parent("li"),n),this.activate(s,s.parent(),function(){t.trigger({type:"shown",relatedTarget:i})})},activate:function(t,n,r){function o(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var i=n.find("> .active"),s=r&&e.support.transition&&i.hasClass("fade");s?i.one(e.support.transition.end,o):o(),i.removeClass("in")}},e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("tab");i||r.data("tab",i=new t(this)),typeof n=="string"&&i[n]()})},e.fn.tab.Constructor=t,e(function(){e("body").on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})})}(window.jQuery),!function(e){var t=function(e,t){this.init("tooltip",e,t)};t.prototype={constructor:t,init:function(t,n,r){var i,s;this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.enabled=!0,this.options.trigger=="click"?this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this)):this.options.trigger!="manual"&&(i=this.options.trigger=="hover"?"mouseenter":"focus",s=this.options.trigger=="hover"?"mouseleave":"blur",this.$element.on(i+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(s+"."+this.type,this.options.selector,e.proxy(this.leave,this))),this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=e.extend({},e.fn[this.type].defaults,t,this.$element.data()),t.delay&&typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);if(!n.options.delay||!n.options.delay.show)return n.show();clearTimeout(this.timeout),n.hoverState="in",this.timeout=setTimeout(function(){n.hoverState=="in"&&n.show()},n.options.delay.show)},leave:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);this.timeout&&clearTimeout(this.timeout);if(!n.options.delay||!n.options.delay.hide)return n.hide();n.hoverState="out",this.timeout=setTimeout(function(){n.hoverState=="out"&&n.hide()},n.options.delay.hide)},show:function(){var e,t,n,r,i,s,o;if(this.hasContent()&&this.enabled){e=this.tip(),this.setContent(),this.options.animation&&e.addClass("fade"),s=typeof this.options.placement=="function"?this.options.placement.call(this,e[0],this.$element[0]):this.options.placement,t=/in/.test(s),e.remove().css({top:0,left:0,display:"block"}).appendTo(t?this.$element:document.body),n=this.getPosition(t),r=e[0].offsetWidth,i=e[0].offsetHeight;switch(t?s.split(" ")[1]:s){case"bottom":o={top:n.top+n.height,left:n.left+n.width/2-r/2};break;case"top":o={top:n.top-i,left:n.left+n.width/2-r/2};break;case"left":o={top:n.top+n.height/2-i/2,left:n.left-r};break;case"right":o={top:n.top+n.height/2-i/2,left:n.left+n.width}}e.css(o).addClass(s).addClass("in")}},setContent:function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},hide:function(){function r(){var t=setTimeout(function(){n.off(e.support.transition.end).remove()},500);n.one(e.support.transition.end,function(){clearTimeout(t),n.remove()})}var t=this,n=this.tip();return n.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?r():n.remove(),this},fixTitle:function(){var e=this.$element;(e.attr("title")||typeof e.attr("data-original-title")!="string")&&e.attr("data-original-title",e.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(t){return e.extend({},t?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||(typeof n.title=="function"?n.title.call(t[0]):n.title),e},tip:function(){return this.$tip=this.$tip||e(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}},e.fn.tooltip=function(n){return this.each(function(){var r=e(this),i=r.data("tooltip"),s=typeof n=="object"&&n;i||r.data("tooltip",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0,html:!0}}(window.jQuery),!function(e){var t=function(e,t){this.init("popover",e,t)};t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype,{constructor:t,setContent:function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content > *")[this.options.html?"html":"text"](n),e.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-content")||(typeof n.content=="function"?n.content.call(t[0]):n.content),e},tip:function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}}),e.fn.popover=function(n){return this.each(function(){var r=e(this),i=r.data("popover"),s=typeof n=="object"&&n;i||r.data("popover",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.popover.Constructor=t,e.fn.popover.defaults=e.extend({},e.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'})}(window.jQuery),!function(e){var t='[data-dismiss="alert"]',n=function(n){e(n).on("click",t,this.close)};n.prototype.close=function(t){function s(){i.trigger("closed").remove()}var n=e(this),r=n.attr("data-target"),i;r||(r=n.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),i=e(r),t&&t.preventDefault(),i.length||(i=n.hasClass("alert")?n:n.parent()),i.trigger(t=e.Event("close"));if(t.isDefaultPrevented())return;i.removeClass("in"),e.support.transition&&i.hasClass("fade")?i.on(e.support.transition.end,s):s()},e.fn.alert=function(t){return this.each(function(){var r=e(this),i=r.data("alert");i||r.data("alert",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.alert.Constructor=n,e(function(){e("body").on("click.alert.data-api",t,n.prototype.close)})}(window.jQuery),!function(e){var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.typeahead.defaults,n),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.$menu=e(this.options.menu).appendTo("body"),this.source=this.options.source,this.shown=!1,this.listen()};t.prototype={constructor:t,select:function(){var e=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(e)).change(),this.hide()},updater:function(e){return e},show:function(){var t=e.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});return this.$menu.css({top:t.top+t.height,left:t.left}),this.$menu.show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(t){var n;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(n=e.isFunction(this.source)?this.source(this.query,e.proxy(this.process,this)):this.source,n?this.process(n):this)},process:function(t){var n=this;return t=e.grep(t,function(e){return n.matcher(e)}),t=this.sorter(t),t.length?this.render(t.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){var t=[],n=[],r=[],i;while(i=e.shift())i.toLowerCase().indexOf(this.query.toLowerCase())?~i.indexOf(this.query)?n.push(i):r.push(i):t.push(i);return t.concat(n,r)},highlighter:function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(new RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},render:function(t){var n=this;return t=e(t).map(function(t,r){return t=e(n.options.item).attr("data-value",r),t.find("a").html(n.highlighter(r)),t[0]}),t.first().addClass("active"),this.$menu.html(t),this},next:function(t){var n=this.$menu.find(".active").removeClass("active"),r=n.next();r.length||(r=e(this.$menu.find("li")[0])),r.addClass("active")},prev:function(e){var t=this.$menu.find(".active").removeClass("active"),n=t.prev();n.length||(n=this.$menu.find("li").last()),n.addClass("active")},listen:function(){this.$element.on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)),(e.browser.chrome||e.browser.webkit||e.browser.msie)&&this.$element.on("keydown",e.proxy(this.keydown,this)),this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this))},move:function(e){if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),this.prev();break;case 40:e.preventDefault(),this.next()}e.stopPropagation()},keydown:function(t){this.suppressKeyPressRepeat=!~e.inArray(t.keyCode,[40,38,9,13,27]),this.move(t)},keypress:function(e){if(this.suppressKeyPressRepeat)return;this.move(e)},keyup:function(e){switch(e.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation(),e.preventDefault()},blur:function(e){var t=this;setTimeout(function(){t.hide()},150)},click:function(e){e.stopPropagation(),e.preventDefault(),this.select()},mouseenter:function(t){this.$menu.find(".active").removeClass("active"),e(t.currentTarget).addClass("active")}},e.fn.typeahead=function(n){return this.each(function(){var r=e(this),i=r.data("typeahead"),s=typeof n=="object"&&n;i||r.data("typeahead",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},e.fn.typeahead.Constructor=t,e(function(){e("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var n=e(this);if(n.data("typeahead"))return;t.preventDefault(),n.typeahead(n.data())})})}(window.jQuery),define("plugin/bootstrap",function(){}),function(e){var t={animationDuration:350,headerOpacity:.25,fixedHeaders:!1,headerSelector:function(e){return e.children("h3").first()},itemSelector:function(e){return e.children(".pivot-item")},headerItemTemplate:function(){return e("<span class='header' />")},pivotItemTemplate:function(){return e("<div class='pivotItem' />")},itemsTemplate:function(){return e("<div class='items' />")},headersTemplate:function(){return e("<div class='headers' />")},controlInitialized:undefined,selectedItemChanged:undefined};e.fn.metroPivot=function(n){return this.length>1?this.each(function(t,r){e(r).wp7Pivot(n)}):(e.extend(this,t,n),e.extend(this,{animating:!1,headers:undefined,items:undefined,goToNext:function(){if(this.animating)return;this.headers.children(".current").next().trigger("click")},goToPrevious:function(){if(this.animating)return;this.headers.children(".header").last().trigger("click")},goToItemByName:function(e){if(this.animating)return;this.headers.children(":contains("+e+")").first().trigger("click")},goToItemByIndex:function(e){if(this.animating)return;this.headers.children().eq(e).trigger("click")},initialize:function(){var t=this,n=t.headersTemplate(),r=t.itemsTemplate();t.itemSelector(t).each(function(i,s){s=e(s);var o=t.headerSelector(s);if(o.length===0)return;var u=t.headerItemTemplate().html(o.html()).fadeTo(0,t.headerOpacity),a=t.pivotItemTemplate().append(s).hide();i===0&&(u.addClass("current").fadeTo(0,1),a.addClass("current").show()),u.attr("index",i),u.click(function(){t.pivotHeader_Click(e(this))}),n.append(u),r.append(a),o.remove()}),t.append(n).append(r),t.headers=n,t.items=r,this.data("controller",t),this.controlInitialized&&this.controlInitialized()},setCurrentHeader:function(t){var n=this;this.headers.children(".header.current").removeClass("current").fadeTo(0,this.headerOpacity),t.addClass("current").fadeTo(0,1);if(n.fixedHeaders===!1){var r=t.prevAll().clone(),i=e(t.prevAll().detach().toArray().reverse());e("<span />").append(r).prependTo(n.headers).animate({width:0,opacity:0},n.animationDuration,function(){e(this).remove(),i.fadeTo(0,0).appendTo(n.headers).fadeTo(200,n.headerOpacity)})}},setCurrentItem:function(e,t){var n=this;n.items.children(".pivotItem.current").hide().removeClass("current"),setTimeout(function(){e.show().addClass("current"),n.currentItemChanged(t)},200)},currentItemChanged:function(e){this.animating=!1,this.selectedItemChanged&&this.selectedItemChanged(e)},pivotHeader_Click:function(e){if(e.is(".current"))return;if(this.animating)return;this.animating=!0,this.setCurrentHeader(e);var t=e.attr("index"),n=this.items.children(".pivotItem:nth("+t+")");this.setCurrentItem(n,t)}}),this.initialize())}}(jQuery),define("plugin/jquery.metro",function(){}),function(e){var t=e({});e.subscribe=function(){t.on.apply(t,arguments)},e.subscribeOnce=function(){t.one.apply(t,arguments)},e.unsubscribe=function(){t.off.apply(t,arguments)},e.publish=function(){t.trigger.apply(t,arguments)}}(jQuery),define("util/pubsub",function(){}),define("helper/colors",["require","exports","module"],function(e,t){var n=["midnightblue","royalblue","orangered","forestgreen","saddlebrown","deeppink","dodgerblue","dimgray","goldenrod","indigo","maroon","navy","purple","darkslateblue","olive","steelblue","darkorange","green","mediumvioletred","teal","seagreen"],r=0,i=n.length;t.get=function(){return r=(r+1)%i,n[r]},t.length=function(){return i},t.used=function(){return r},t.reset=function(){r=0}}),define("model/module",["require","exports","module","helper/colors"],function(e,t){function r(e,t){if(!e)throw new Error("Module data cannot be null!");this.id=e.code.replace(/[_\s\'\"]/gi,"-"),this.data=e,this.data.color=n.get(),this.status=$.extend({},{visible:!0,allocated:{},onCORS:!1},t)}var n=e("helper/colors");return r.Count=function(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&(n+=1);return n},r.fn=r.prototype,r.fn.get=function(e){return this.data[e]},r.fn.has=function(e){return!$.isEmptyObject(this.data[e])},r.fn.set=function(e,t){var n,r=e.split("."),i=r.length,s=this.status;for(n=0;n<i-1;n++)s[r[n]]=s[r[n]]||{},s=s[r[n]];s[r[n]]=t,$.publish("module:save")},r.fn.is=function(e){var t,n=e.split("."),r=n.length,i=this.status;for(t=0;t<r-1;t++)i[n[t]]=i[n[t]]||{},i=i[n[t]];return i[n[t]]},r.fn.count=function(e){return r.Count(this.data.lessons[e])},r.fn.isSame=function(e){return typeof e=="object"?this.data.code===e.get("code"):typeof e=="string"?this.data.code===e.toUpperCase():!1},r.fn.allocated=function(e){return this.status.allocated[e]},r.fn.allocate=function(e,t){this.status.allocated[e]=t,$.publish("module:"+this.get("code")+":allocated",[e,t]),$.publish("module:save")},r.fn.toJSON=function(){return{data:this.data,status:this.status}},r.fn.compress=function(){return{id:this.get("code"),visible:this.status.visible,allocated:this.status.allocated}},r}),define("api/yql",["require","exports","module"],function(e,t){function n(e){this.url=e}function r(e,t){return function(n){n.url=e,t(n)}}function i(e){return $.ajax({type:"GET",dataType:"jsonp",contentType:"application/x-javascript",url:e,xhrFields:{widthCredentials:!1}})}return n.prototype={yqlUrl:function(e){return"http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(e)+"&format=json"},querySelect:function(e,t){return t=t||"//table","select * from html where url='"+e+"' and xpath='"+t+"'"},request:function(e,t){return i(this.yqlUrl(e)).success(t)},requestModule:function(e,t){var n=this.url(e);return this.request(this.querySelect(n.url,n.xpath),r(n.url,t))}},n}),define("api/crawler",["require","exports","module","api/yql"],function(e,t){function u(t,s){!i||!r?e(["school/"+planner.school+"/url","school/"+planner.school+"/parser"],function(e,o){r=o,i=new n(e),a(t,s,0)}):a(t,s,0)}function a(e,t,n){if(n===0){if(s[e])return;s[e]=!0,$.publish("module:fetching",e)}else if(n===o){$.publish("module:"+e+":fetched"),$.publish("message:error","Fetching data for Module "+e+" failed, Please try again later.");return}i.requestModule(e,function(i){var o,u=!0;try{o=r.parse(i),o!==null?o.isAvailable?t(o):$.publish("message:error","Module "+e+" is not available now."):(u=!1,a(e,t,n+1))}catch(f){$.publish("message:error",f.toString())}u&&(delete s[e],$.publish("module:"+e+":fetched"))})}var n=e("api/yql"),r,i,s={},o=3;$.subscribe("app:school",function(){r=null,i=null}),t.crawl=u}),define("model/modules",["require","exports","module","model/module","api/crawler"],function(e,t){function i(e,t){this.name=e,this.list=[],this.options=$.extend({},{mute:!1,prefix:this.name+":"},t)}var n=e("model/module"),r=e("api/crawler");return i.fn=i.prototype,i.fn.find=function(e){var t=0,n=this.list.length;for(;t<n;t++)if(this.list[t].isSame(e))return t;return-1},i.fn.get=function(e){return typeof e=="number"&&e>=0&&e<this.list.length?this.list[e]:typeof e=="string"||typeof e=="object"?this.get(this.find(e)):null},i.fn.add=function(e,t,i){t=$.extend({},this.options,t),this.find(e)===-1?typeof e=="object"?this._add(e,t):typeof e=="string"&&r.crawl(e,$.proxy(function(e){this._add(new n(e,i),t)},this)):t.mute||$.publish(t.prefix+"addOne:duplicated",this.get(e))},i.fn.populate=function(e,t){var r,i=e.length;for(r=0;r<i;r++)this._add(new n(e[r].data,e[r].status),t)},i.fn._add=function(e,t){var n=this.duplicated("examDate",e.get("examDate"));t=$.extend({},this.options,t),e.set("list",this.name),this.list.push(e),$.publish("module:save"),t.mute||($.publish(t.prefix+"addOne",[e]),n>=0&&e.get("examDate").indexOf("No Exam")<0&&$.publish(t.prefix+"duplicatedExamDate",[this.get(n),e]))},i.fn.remove=function(e,t){var n;return t=$.extend({},this.options,t),typeof e=="number"&&e>=0&&e<this.list.length?(n=this.list.splice(e,1)[0],$.publish("module:save"),t.mute||$.publish(t.prefix+"removeOne",[n]),n):typeof e=="string"||typeof e=="object"?this.remove(this.find(e),t):null},i.fn.clean=function(e){e=$.extend({},this.options,e),this.list=[],$.publish("module:save"),e.mute||$.publish(e.prefix+"clean")},i.fn.length=function(){return this.list.length},i.fn.duplicated=function(e,t){if(t==="-")return-1;var n,r=this.list.length;for(n=0;n<r;n++)if(this.list[n].get(e)===t)return n;return-1},i.fn.inSequence=function(e){var t=[],n,r=e.length;for(n=0;n<r;n++)t.push(this.get(e[n]));this.list=t},i.fn.toJSON=function(){var e=[],t,n=this.list.length;for(t=0;t<n;t++)e.push(this.list[t].toJSON());return e},i.fn.compress=function(){var e=[],t,n=this.list.length;for(t=0;t<n;t++)e.push(this.list[t].compress());return e},i}),define("controller/modulesController",["require","exports","module","model/modules","util/store"],function(e,t){function s(){r.populate(i.get(planner.list.modules)||[])}function o(){i.set(planner.list.modules,r.toJSON())}var n=e("model/modules"),r=new n(planner.list.modules),i=e("util/store");t.init=function(){setTimeout(function(){s()},190)},$.subscribe("module:save",function(){o()}),$.subscribe("module:add",function(e,t){r.add(t)}),$.subscribe("module:sequence",function(e,t){r.inSequence(t),o()}),$.subscribe("module:share",function(){var e=r.compress(),t=[],n,i=e.length;for(n=0;n<i;n++)t.push(e[n].id+"|"+(e[n].visible?1:0)+"|"+JSON.stringify(e[n].allocated));$.publish("app:share:get",[t.join("&")])}),$.subscribe("module:readFromShare",function(e,t){var n,i=t.length,s;for(n=0;n<i;n++)s=t[n].split("|"),r.add(s[0],null,{visible:s[1]==="1",allocated:JSON.parse(s[2])})}),$.subscribe("module:preview",function(e,t){var n=r.get(t);n&&$.publish("module:detail",n)}),$.subscribe("module:remove",function(e,t){var n=r.remove(t);n&&$.publish("message:success","Module "+n.get("code")+" is removed")}),$.subscribe("module:clean",function(){r.clean(),$.publish("module:clean:all"),$.publish("message:success","All modules are removed"),planner.trackEvent("clear-modules","")})}),define("view/schoolView",["require","exports","module"],function(e,t){function r(){$("#school-abbr").text(planner.school.split(".")[1].toUpperCase())}function i(){n.on("click","a",function(e){e.preventDefault();var t=$(this).data("school");t!==planner.school&&(planner.school?$.publish("module:clean"):$("body").chardinJs("start"),planner.set("school",t),r()),n.modal("hide"),planner.trackEvent("change-school",t!==planner.school)})}var n=$("#select-school");t.init=function(){i(),planner.school?r():(e(["plugin/chardinjs.min"]),n.modal("show"))}}),define("util/helper",["require","exports","module"],function(e,t){function n(e){var t={startYear:2012,endYear:2013,acadYear:"2012/2013",semester:2},n=e.getFullYear(),r=e.getMonth()+1;return r<5?(t.startYear=n-1,t.endYear=n,t.semester=2):r>11?(t.startYear=n,t.endYear=n+1,t.semester=2):(t.startYear=n,t.endYear=n+1,t.semester=1),t.acadYear=t.startYear+"/"+t.endYear,t}function r(e){var t=e.getFullYear(),n=e.getMonth()+1,r=new Date,i=0;r.setMonth(0),r.setDate(1),n<=5||(n>=12?r.setMonth(0):r.setMonth(7));for(;;){if(r.getDay()===1)break;r.setDate(r.getDate()+1)}return r.setDate(r.getDate()+7),r}t.Semester=n(new Date),t.getSemester=function(e){return e?t.Semester:n(e)},t.WeekOneDate=r(new Date),t.getWeekOneDate=function(e){return e?r(e):t.WeekOneDate},t.getWeekOneDateOfWeekday=function(e,n){var i=$.inArray(e.toUpperCase(),planner.weekDays);return n=n?r(n):t.WeekOneDate,i<0?n:(n.setDate(n.getDate()+i),n)},t.getDateFormatted=function(e){var t=""+e.getFullYear(),n=("0"+(e.getMonth()+1)).slice(-2),r=("0"+e.getDate()).slice(-2),i=("0"+e.getHours()).slice(-2),s=("0"+e.getMinutes()).slice(-2);return r+"-"+n+"-"+t+" "+i+":"+s+":00"},t.getTimeIndex=function(e){return e=parseInt(e,10),2+(Math.floor(e/100)-8)*2+(e%100?1:0)}}),define("view/addModuleView",["require","exports","module","util/store","util/helper"],function(e,t){function o(){$("#semester").text("Year "+r.acadYear+" SEM"+r.semester)}function u(){$("#term-ctrls").tooltip({placement:"bottom",selector:"li[rel=tooltip]"})}function a(){i.typeahead({source:[],items:59,updater:c}),planner.school&&f(),$.subscribe("app:school",f)}function f(){var t=planner.school+"-module-data",r=n.get(t);e(["school/"+planner.school+"/info"],function(s){r&&r.lastUpdate===s.lastUpdate?i.data("typeahead").source=r.data:e(["school/"+planner.school+"/data/list"],function(e){n.set(t,{lastUpdate:s.lastUpdate,data:e}),i.data("typeahead").source=e})})}function l(){i.on("focus",function(e){this.select()}),s.on("click",function(e){e.preventDefault(),c(i.val())})}function c(e){e=e.split(" ")[0],e&&/^[a-z]{1,4}\d{3,4}[a-z]{0,2}$/i.test(e)?(i.val(""),$.publish("module:add",[e.toUpperCase()]),planner.trackEvent("add-module",e.toUpperCase())):$.publish("message:error",["The Module Code '"+e.toUpperCase()+"' is not Valid!"])}var n=e("util/store"),r=e("util/helper").Semester,i=$("#mod-code"),s=$("#add-btn");t.init=function(){o(),a(),l(),u()},$.subscribe("app:window:resize",function(){var e=$("#add-module").width();$("#add-module").find("#mod-code").width(e-84)})}),define("helper/jquery.module",["require","exports","module"],function(e,t){(function(e){var t="planner_",n="modules",r=e("#tt-grid"),i=function(t,n){this.$elem=e(t),this.init(n)};i.prototype={constructor:i,init:function(e){this.$method=this.$elem.find(".method"),this.$info=this.$elem.find(".info"),this.data=e.data,this.id=this.data.get("code"),this.clash=[],this.updateElem(),this.attachEvents(),this.subscribeEvents()},get:function(e){return this.data.get(e)},updateElem:function(){this.data.is("visible")||this.showOnTimetable(!1)},showOnTimetable:function(e,t,n){t=t||this.$method.find(".timetable i"),n=n||this.$elem,e?(n.removeClass("inactive"),t.removeClass("icon-eye-close").addClass("icon-eye-open")):(n.addClass("inactive"),t.removeClass("icon-eye-open").addClass("icon-eye-close"))},attachEvents:function(t,n){var i=this,s=function(){e.publish("module:detail",i.data),e("#metro-pivot").data("controller").goToItemByName("Detail")};this.$elem.on("mouseenter",function(){r.find(".slot[id^="+i.id+"-]").addClass("hover")}),this.$elem.on("mouseleave",function(){r.find(".slot[id^="+i.id+"-]").removeClass("hover")}),this.$info.on("click",".icon-on-cors",function(e){var t=i.$elem.hasClass("on-cors");i.$elem.toggleClass("on-cors"),i.data.set("onCORS",!t),e.stopPropagation()}),this.$method.on("click",".detail",s),this.$method.on("click",".timetable",function(){var t=e(this).find("i");t.hasClass("icon-eye-open")?(t.removeClass("icon-eye-open").addClass("icon-eye-close"),i.$elem.addClass("inactive"),i.data.set("visible",!1),r.find(".slot[id^="+i.id+"-]").remove(),e.publish("grid:refresh")):(t.removeClass("icon-eye-close").addClass("icon-eye-open"),i.$elem.removeClass("inactive"),i.data.set("visible",!0),e.publish("grid:module:reallocate",i.data))}),this.$method.on("click",".remove",function(){e(this).tooltip("destroy"),i.removeClash(),r.find(".slot[id^="+i.id+"-]").remove(),e.publish("grid:rows:clearEmpty"),i.$elem.fadeOut(500,function(){i.$elem.remove(),e.publish("module:remove",i.id)})})},subscribeEvents:function(){var t=this;e.subscribe("module:clean:all",function(){t.$method.find(".remove").trigger("click")}),this.$elem.on("clash.add",function(n,r){if(e.isArray(r)){if(r.length===0)return;t.clash=t.clash.concat(r)}else t.clash.push(r);t.handleClash()}),this.$elem.on("clash.remove",function(n,r){var i=e.inArray(r,t.clash);i>=0&&t.clash.splice(i,1),t.handleClash()})},handleClash:function(){this.clash.length>0&&!this.$elem.hasClass("clashing")?this.$elem.addClass("clashing"):this.clash.length===0&&this.$elem.removeClass("clashing")},removeClash:function(){var t,n=this.clash.length,r;if(n<0)return;r=this.clash.splice(0,1)[0],e("#"+r).trigger("clash.remove",[this.id]).trigger("clash.add",[this.clash]);for(t=1;t<n;t++)e("#"+this.clash[t]).trigger("clash.remove",[this.id]).trigger("clash.add",[r])}},e.fn.module=function(r){return this.each(function(){e.data(this,t+n)||e.data(this,t+n,new i(this,r))})}})(jQuery)}),define("helper/jquery.loading",["require","exports","module"],function(e,t){(function(e){var t="planner_",n="loading",r=function(t,n){this.$elem=e(t),this.init(n)};r.prototype={constructor:r,init:function(e){this.id=e.id,this.animate=!0,this.$method=this.$elem.find(".method"),this.$load=this.$method.find("i"),this.$info=this.$elem.find(".info"),this.attachAnimations(),this.subscribeEvents()},attachAnimations:function(){var e=this;(function t(){if(!e.animate)return;setTimeout(function(){e.$load.animate({"margin-top":"-5px"},100).animate({"margin-top":"25px"},900,function(){e.$load.css("margin-top","-20px")}).animate({"margin-top":"0px"},1e3,function(){t()})},500)})()},subscribeEvents:function(){var t=this;e.subscribeOnce("module:"+this.id+":fetched",function(){t.animate=!1,t.$elem.slideUp(function(){t.$elem.remove()})})}},e.fn.loading=function(i){return this.each(function(){e.data(this,t+n)||e.data(this,t+n,new r(this,i))})}})(jQuery)}),define("hogan",["require","exports","module"],function(e,t,n){var r={};(function(e,t){function a(e){return String(e===null||e===undefined?"":e)}function f(e){return e=a(e),u.test(e)?e.replace(n,"&amp;").replace(r,"&lt;").replace(i,"&gt;").replace(s,"&#39;").replace(o,"&quot;"):e}e.Template=function(e,n,r,i){this.r=e||this.r,this.c=r,this.options=i,this.text=n||"",this.buf=t?[]:""},e.Template.prototype={r:function(e,t,n){return""},v:f,t:a,render:function(t,n,r){return this.ri([t],n||{},r)},ri:function(e,t,n){return this.r(e,t,n)},rp:function(e,t,n,r){var i=n[e];return i?(this.c&&typeof i=="string"&&(i=this.c.compile(i,this.options)),i.ri(t,n,r)):""},rs:function(e,t,n){var r=e[e.length-1];if(!l(r)){n(e,t,this);return}for(var i=0;i<r.length;i++)e.push(r[i]),n(e,t,this),e.pop()},s:function(e,t,n,r,i,s,o){var u;return l(e)&&e.length===0?!1:(typeof e=="function"&&(e=this.ls(e,t,n,r,i,s,o)),u=e===""||!!e,!r&&u&&t&&t.push(typeof e=="object"?e:t[t.length-1]),u)},d:function(e,t,n,r){var i=e.split("."),s=this.f(i[0],t,n,r),o=null;if(e==="."&&l(t[t.length-2]))return t[t.length-1];for(var u=1;u<i.length;u++)s&&typeof s=="object"&&i[u]in s?(o=s,s=s[i[u]]):s="";return r&&!s?!1:(!r&&typeof s=="function"&&(t.push(o),s=this.lv(s,t,n),t.pop()),s)},f:function(e,t,n,r){var i=!1,s=null,o=!1;for(var u=t.length-1;u>=0;u--){s=t[u];if(s&&typeof s=="object"&&e in s){i=s[e],o=!0;break}}return o?(!r&&typeof i=="function"&&(i=this.lv(i,t,n)),i):r?!1:""},ho:function(e,t,n,r,i){var s=this.c,o=this.options;o.delimiters=i;var r=e.call(t,r);return r=r==null?String(r):r.toString(),this.b(s.compile(r,o).render(t,n)),!1},b:t?function(e){this.buf.push(e)}:function(e){this.buf+=e},fl:t?function(){var e=this.buf.join("");return this.buf=[],e}:function(){var e=this.buf;return this.buf="",e},ls:function(e,t,n,r,i,s,o){var u=t[t.length-1],a=null;if(!r&&this.c&&e.length>0)return this.ho(e,u,n,this.text.substring(i,s),o);a=e.call(u);if(typeof a=="function"){if(r)return!0;if(this.c)return this.ho(a,u,n,this.text.substring(i,s),o)}return a},lv:function(e,t,n){var r=t[t.length-1],i=e.call(r);if(typeof i=="function"){i=a(i.call(r));if(this.c&&~i.indexOf("{{"))return this.c.compile(i,this.options).render(r,n)}return a(i)}};var n=/&/g,r=/</g,i=/>/g,s=/\'/g,o=/\"/g,u=/[&<>\"\']/,l=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}})(typeof t!="undefined"?t:r),function(e){function u(e){e.n.substr(e.n.length-1)==="}"&&(e.n=e.n.substring(0,e.n.length-1))}function a(e){return e.trim?e.trim():e.replace(/^\s*|\s*$/g,"")}function f(e,t,n){if(t.charAt(n)!=e.charAt(0))return!1;for(var r=1,i=e.length;r<i;r++)if(t.charAt(n+r)!=e.charAt(r))return!1;return!0}function l(e,t,n,r){var i=[],s=null,o=null;while(e.length>0){o=e.shift();if(o.tag=="#"||o.tag=="^"||c(o,r))n.push(o),o.nodes=l(e,o.tag,n,r),i.push(o);else{if(o.tag=="/"){if(n.length===0)throw new Error("Closing tag without opener: /"+o.n);s=n.pop();if(o.n!=s.n&&!h(o.n,s.n,r))throw new Error("Nesting error: "+s.n+" vs. "+o.n);return s.end=o.i,i}i.push(o)}}if(n.length>0)throw new Error("missing closing tag: "+n.pop().n);return i}function c(e,t){for(var n=0,r=t.length;n<r;n++)if(t[n].o==e.n)return e.tag="#",!0}function h(e,t,n){for(var r=0,i=n.length;r<i;r++)if(n[r].c==e&&n[r].o==t)return!0}function p(e){return e.replace(s,"\\\\").replace(n,'\\"').replace(r,"\\n").replace(i,"\\r")}function d(e){return~e.indexOf(".")?"d":"f"}function v(e){var t="";for(var n=0,r=e.length;n<r;n++){var i=e[n].tag;i=="#"?t+=m(e[n].nodes,e[n].n,d(e[n].n),e[n].i,e[n].end,e[n].otag+" "+e[n].ctag):i=="^"?t+=g(e[n].nodes,e[n].n,d(e[n].n)):i=="<"||i==">"?t+=y(e[n]):i=="{"||i=="&"?t+=b(e[n].n,d(e[n].n)):i=="\n"?t+=E('"\\n"'+(e.length-1==n?"":" + i")):i=="_v"?t+=w(e[n].n,d(e[n].n)):i===undefined&&(t+=E('"'+p(e[n])+'"'))}return t}function m(e,t,n,r,i,s){return"if(_.s(_."+n+'("'+p(t)+'",c,p,1),'+"c,p,0,"+r+","+i+',"'+s+'")){'+"_.rs(c,p,"+"function(c,p,_){"+v(e)+"});c.pop();}"}function g(e,t,n){return"if(!_.s(_."+n+'("'+p(t)+'",c,p,1),c,p,1,0,0,"")){'+v(e)+"};"}function y(e){return'_.b(_.rp("'+p(e.n)+'",c,p,"'+(e.indent||"")+'"));'}function b(e,t){return"_.b(_.t(_."+t+'("'+p(e)+'",c,p,0)));'}function w(e,t){return"_.b(_.v(_."+t+'("'+p(e)+'",c,p,0)));'}function E(e){return"_.b("+e+");"}var t=/\S/,n=/\"/g,r=/\n/g,i=/\r/g,s=/\\/g,o={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10};e.scan=function(n,r){function S(){v.length>0&&(m.push(new String(v)),v="")}function x(){var e=!0;for(var n=b;n<m.length;n++){e=m[n].tag&&o[m[n].tag]<o._v||!m[n].tag&&m[n].match(t)===null;if(!e)return!1}return e}function T(e,t){S();if(e&&x())for(var n=b,r;n<m.length;n++)m[n].tag||((r=m[n+1])&&r.tag==">"&&(r.indent=m[n].toString()),m.splice(n,1));else t||m.push({tag:"\n"});g=!1,b=m.length}function N(e,t){var n="="+E,r=e.indexOf(n,t),i=a(e.substring(e.indexOf("=",t)+1,r)).split(" ");return w=i[0],E=i[1],r+n.length-1}var i=n.length,s=0,l=1,c=2,h=s,p=null,d=null,v="",m=[],g=!1,y=0,b=0,w="{{",E="}}";r&&(r=r.split(" "),w=r[0],E=r[1]);for(y=0;y<i;y++)h==s?f(w,n,y)?(--y,S(),h=l):n.charAt(y)=="\n"?T(g):v+=n.charAt(y):h==l?(y+=w.length-1,d=o[n.charAt(y+1)],p=d?n.charAt(y+1):"_v",p=="="?(y=N(n,y),h=s):(d&&y++,h=c),g=y):f(E,n,y)?(m.push({tag:p,n:a(v),otag:w,ctag:E,i:p=="/"?g-E.length:y+w.length}),v="",y+=E.length-1,h=s,p=="{"&&(E=="}}"?y++:u(m[m.length-1]))):v+=n.charAt(y);return T(g,!0),m},e.generate=function(t,n,r){var i='var _=this;_.b(i=i||"");'+v(t)+"return _.fl();";return r.asString?"function(c,p,i){"+i+";}":new e.Template(new Function("c","p","i",i),n,e,r)},e.parse=function(e,t,n){return n=n||{},l(e,"",[],n.sectionTags||[])},e.cache={},e.compile=function(e,t){t=t||{};var n=e+"||"+!!t.asString,r=this.cache[n];return r?r:(r=this.generate(this.parse(this.scan(e,t.delimiters),e,t),e,t),this.cache[n]=r)}}(typeof t!="undefined"?t:r)}),define("text",{}),define("hgn",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("hgn!template/module",["hogan"],function(e){var t=new e.Template(function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div id="'),r.b(r.v(r.f("id",e,t,0))),r.b('" class="module clearfix '),r.s(r.f("onCORS",e,t,1),e,t,0,51,58,"{{ }}")&&(r.rs(e,t,function(e,t,n){n.b("on-cors")}),e.pop()),r.b('">'),r.b("\n"+n),r.b('    <ul class="method unstyled" style="background-color:'),r.b(r.v(r.f("color",e,t,0))),r.b('">'),r.b("\n"+n),r.b('        <li class="remove" title="Remove Module" rel="tooltip">'),r.b("\n"+n),r.b('            <i class="icon-remove icon-white"></i></li>'),r.b("\n"+n),r.b('        <li class="detail" title="View Detail" rel="tooltip">'),r.b("\n"+n),r.b('            <i class="icon-info-sign icon-white"></i></li>'),r.b("\n"+n),r.b('        <li class="timetable" title="Show/Hide in Timetable" rel="tooltip">'),r.b("\n"+n),r.b('            <i class="icon-eye-open icon-white"></i></li>'),r.b("\n"+n),r.b("    </ul>"),r.b("\n"+n),r.b('    <div class="info">'),r.b("\n"+n),r.b('        <div class="code">'),r.b(r.v(r.f("code",e,t,0))),r.b(' <i class="icon-on-cors"></i></div>'),r.b("\n"+n),r.b('        <div class="title">'),r.b(r.v(r.f("title",e,t,0))),r.b("</div>"),r.b("\n"+n),r.b('        <div class="examdate">'),r.b(r.v(r.f("examDate",e,t,0))),r.b("</div>"),r.b("\n"+n),r.b("    </div>"),r.b("\n"+n),r.b("</div>"),r.b("\n"),r.fl()},"",e);return function(){return t.render.apply(t,arguments)}}),define("hgn!template/loading",["hogan"],function(e){var t=new e.Template(function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div id="'),r.b(r.v(r.f("id",e,t,0))),r.b('-loading" class="module loading clearfix">'),r.b("\n"+n),r.b('    <div class="method">'),r.b("\n"+n),r.b('        <div><i class="icon-download-alt icon-white"></i></div>'),r.b("\n"+n),r.b("    </div>"),r.b("\n"+n),r.b('    <div class="info">'),r.b("\n"+n),r.b('        <div class="code">Loading '),r.b(r.v(r.f("id",e,t,0))),r.b("</div>"),r.b("\n"+n),r.b("    </div>"),r.b("\n"+n),r.b("</div>"),r.b("\n"),r.fl()},"",e);return function(){return t.render.apply(t,arguments)}}),define("view/moduleView",["require","exports","module","helper/jquery.module","helper/jquery.loading","hgn!template/module","hgn!template/loading"],function(e,t){e("helper/jquery.module"),e("helper/jquery.loading");var n=e("hgn!template/module"),r=e("hgn!template/loading");t.render=function(e){var t={id:e.id,color:e.get("color"),code:e.get("code"),title:e.get("title"),examDate:e.get("examDate"),onCORS:e.is("onCORS")},r=$(n(t));return r.module({data:e}),r},t.loading=function(e){var t={id:e},n=$(r(t));return n.loading(t),n}}),define("view/basketView",["require","exports","module","view/moduleView"],function(e,t){function i(){$("#metro-pivot").data("controller").goToItemByName("Modules")}var n=e("view/moduleView"),r=$("#basket-scroll");t.init=function(){r.tooltip({placement:"right",selector:"li[rel=tooltip]"}),r.sortable({containment:"parent",tolerance:"pointer",handle:".info",forcePlaceholderSize:!0,opacity:.3,scroll:!1,update:function(e,t){$.publish("module:sequence",[r.sortable("toArray")])}})},$.subscribe(planner.list.modules+":addOne",function(e,t){i(),n.render(t).hide().appendTo(r).slideDown()}),$.subscribe("module:fetching",function(e,t){i(),n.loading(t).hide().prependTo(r).slideDown()}),$.subscribe(planner.list.modules+":duplicatedExamDate",function(e,t,n){var r=t.get("code"),i=n.get("code");$("#"+r).trigger("clash.add",[i]),$("#"+i).trigger("clash.add",[r]),$.publish("message:warning",["Exam Date ("+t.get("examDate")+") clashes between "+i+" "+n.get("title")+" and "+r+" "+t.get("title")+"."])})}),define("hgn!template/moduleDetail",["hogan"],function(e){var t=new e.Template(function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div id="module-detail" data-modcode="'),r.b(r.v(r.f("code",e,t,0))),r.b('">'),r.b("\n"+n),r.b('    <h4 style="color:'),r.b(r.v(r.f("color",e,t,0))),r.b('">'),r.b(r.v(r.f("code",e,t,0))),r.b(" - "),r.b(r.v(r.f("title",e,t,0))),r.b("</h4>"),r.b("\n"+n),r.b('    <p><a href="'),r.b(r.v(r.f("url",e,t,0))),r.b('" target="_blank" title="View on CORS">'),r.b("\n"+n),r.b("        Correct As At: "),r.b(r.v(r.f("correctAsAt",e,t,0))),r.b("\n"+n),r.b("    </a></p>"),r.b("\n"+n),r.b('    <table class="table">'),r.b("\n"+n),r.b("        <tbody>"),r.b("\n"+n),r.b('        <tr><th colspan="4">Exam Date</th></tr>'),r.b("\n"+n),r.b('        <tr><td colspan="4">'),r.b(r.v(r.f("examDate",e,t,0))),r.b("</td></tr>"),r.b("\n"+n),r.b("        <tr>"),r.b("\n"+n),r.b("            <th>Credits</th><td>"),r.b(r.v(r.f("credits",e,t,0))),r.b("</td>"),r.b("\n"+n),r.b("            <th>Workload</th><td>"),r.b(r.v(r.f("workload",e,t,0))),r.b("</td>"),r.b("\n"+n),r.b("        </tr>"),r.b("\n"+n),r.b('        <tr><th colspan="4">Description</th></tr>'),r.b("\n"+n),r.b('        <tr><td colspan="4">'),r.b(r.v(r.f("description",e,t,0))),r.b("</td></tr>"),r.b("\n"+n),r.b('        <tr><th colspan="4">Pre-requisite</th></tr>'),r.b("\n"+n),r.b('        <tr><td colspan="4">'),r.b(r.v(r.f("prerequisite",e,t,0))),r.b("</td></tr>"),r.b("\n"+n),r.b('        <tr><th colspan="4">Preclusion</th></tr>'),r.b("\n"+n),r.b('        <tr><td colspan="4">'),r.b(r.v(r.f("preclusion",e,t,0))),r.b("</td></tr>"),r.b("\n"+n),r.b("        </tbody>"),r.b("\n"+n),r.b("    </table>"),r.b("\n"+n),r.b("</div>"),r.b("\n"),r.fl()},"",e);return function(){return t.render.apply(t,arguments)}}),define("view/detailView",["require","exports","module","hgn!template/moduleDetail"],function(e,t){function i(e,t){t?(n.html(r(t.data)),n.data("module",t.get("code"))):n.html("<p>Module's detail is not found. :(</p>"),planner.trackEvent("view-module-detail",t.get("code"))}var n=$("#detail"),r=e("hgn!template/moduleDetail");t.init=function(){$("#metro-pivot").metroPivot(),n.on("dblclick",function(){$("#metro-pivot").data("controller").goToItemByName("Modules")})},$.subscribe("app:status:new",function(){$("#metro-pivot").data("controller").goToItemByName("Detail")}),$.subscribe("module:detail",i),$.subscribe(planner.list.previews+":addOne",i)}),define("util/toastr",["require","exports","module"],function(e,t){var n=function(){var e={tapToDismiss:!0,toastClass:"toast",containerId:"toast-container",debug:!1,fadeIn:300,fadeOut:700,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},iconClass:"toast-info",positionClass:"toast-bottom-right",timeOut:3e3,titleClass:"toast-title",messageClass:"toast-message"},t=function(e,t){return o({iconClass:i().iconClasses.error,message:e,title:t})},r=function(e){var t=$("#"+e.containerId);return t.length?t:(t=$("<div/>").attr("id",e.containerId).addClass(e.positionClass),t.appendTo($("body")),t)},i=function(){return $.extend({},e,n.options)},s=function(e,t){return o({iconClass:i().iconClasses.info,message:e,title:t})},o=function(e){var t=i(),n=e.iconClass||t.iconClass,s=null,o=r(t),a=$("<div/>"),f=$("<div/>"),l=$("<div/>"),c={options:t,map:e};e.iconClass&&a.addClass(t.toastClass).addClass(n),e.title&&(f.append(u(e.title)).addClass(t.titleClass),a.append(f)),e.message&&(l.append(u(e.message)).addClass(t.messageClass),a.append(l));var h=function(){if($(":focus",a).length>0)return;var e=function(){return a.fadeOut(t.fadeOut)};$.when(e()).done(function(){if(a.is(":visible"))return;a.remove(),o.children().length===0&&o.remove()})},p=function(){clearTimeout(s),a.stop(!0,!0).fadeIn(t.fadeIn)};return a.hide(),o.prepend(a),a.fadeIn(t.fadeIn),t.timeOut>0&&(s=setTimeout(h,t.timeOut)),a.hover(p,h),t.tapToDismiss&&a.click(h),t.debug&&console.log(c),a},u=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},a=function(e,t){return o({iconClass:i().iconClasses.success,message:e,title:t})},f=function(e,t){return o({iconClass:i().iconClasses.warning,message:e,title:t})};return{error:t,info:s,options:{},success:a,warning:f}}();return n}),define("view/messageView",["require","exports","module","util/toastr"],function(e,t){var n=e("util/toastr");t.init=function(){},$.subscribe("message:error",function(e,t){n.error(t),planner.trackEvent("message-error",t)}),$.subscribe("message:warning",function(e,t){n.warning(t),planner.trackEvent("message-warn",t)}),$.subscribe("message:info",function(e,t){n.info(t)}),$.subscribe("message:success",function(e,t){n.success(t)}),$.subscribe(planner.list.modules+":addOne:duplicated",function(e,t){n.error("Module "+t.get("code")+" "+t.get("title")+" is in your module list.")})}),define("view/shareView",["require","exports","module"],function(e,t){function o(){var e=/#share=(.*)&school=(.*)/ig.exec(decodeURIComponent(location.hash));e&&e.length===3&&(location.hash="",planner.set("school",e[2]),$.publish("module:readFromShare",[e[1].split("&")])),planner.trackEvent("open-from-share",e&&e.length===3)}function u(e,t){var r=s+"#share="+t+"&school="+planner.get("school");$.get(i+encodeURIComponent(r),function(e){var t=e.data.url;n.find("#short-link-url").val(t),n.find(".share-btn").attr("href",n.find(".share-btn").attr("href")+t)}),n.modal("show"),planner.trackEvent("share","bitly")}function a(){n.find(".black.m-btn").on("click",function(){$(this).html("Ctrl + C to copy"),$("#short-link-url").focus()}),$("#short-link-url").on("focus",function(){$(this).select()})}var n=$("#short-link-modal"),r="fe44adc346767b3234c5231a0b8cfb4f12c3ed69",i="https://api-ssl.bitly.com/v3/shorten?access_token="+r+"&longUrl=",s="http://cors.bicrement.com";t.init=function(){o(),a()},$.subscribe("app:share:get",u),$.subscribe("module:calendar",function(){planner.trackEvent("share","calendar")})}),define("hgn!template/addThisEvent",["hogan"],function(e){var t=new e.Template(function(e,t,n){var r=this;return r.b(n=n||""),r.b('<a href="http://cors.bicrement.com" title="Add to Google Calendar" class="addthisevent" data-direct="google">'),r.b("\n"+n),r.b('    <i class="icon-calendar icon-white"></i>'),r.b("\n"+n),r.b('    <span class="_start" style="display:none">'),r.b(r.v(r.d("time.startDateTime",e,t,0))),r.b("</span>"),r.b("\n"+n),r.b('    <span class="_end" style="display:none">'),r.b(r.v(r.d("time.endDateTime",e,t,0))),r.b("</span>"),r.b("\n"+n),r.b('    <span class="_zonecode" style="display:none">79</span>'),r.b("\n"+n),r.b('    <span class="_summary" style="display:none">'),r.b(r.v(r.d("module.code",e,t,0))),r.b(" ("),r.b(r.v(r.d("slot.type",e,t,0))),r.b(")</span>"),r.b("\n"+n),r.b('    <span class="_description" style="display:none">Module: '),r.b(r.v(r.d("module.code",e,t,0))),r.b(" - "),r.b(r.v(r.d("module.title",e,t,0))),r.b("\\nType: "),r.b(r.v(r.d("slot.type",e,t,0))),r.b("\\nClass Num: "),r.b(r.v(r.d("slot.classNo",e,t,0))),r.b("\\nTime: "),r.b(r.v(r.d("slot.startTime",e,t,0))),r.b(" - "),r.b(r.v(r.d("slot.endTime",e,t,0))),r.b("\\nWeek: "),r.b(r.v(r.d("slot.weekType",e,t,0))),r.b("\\nDay: "),r.b(r.v(r.d("slot.weekDay",e,t,0))),r.b("\\n</span>"),r.b("\n"+n),r.b('    <span class="_location" style="display:none">'),r.b(r.v(r.d("slot.room",e,t,0))),r.b("</span>"),r.b("\n"+n),r.b('    <span class="_all_day_event" style="display:none">false</span>'),r.b("\n"+n),r.b('    <span class="_date_format" style="display:none">DD/MM/YYYY</span>'),r.b("\n"+n),r.b("</a>"),r.b("\n"),r.fl()},"",e);return function(){return t.render.apply(t,arguments)}}),define("helper/jquery.slot",["require","exports","module","util/helper","hgn!template/addThisEvent"],function(e,t){var n=e("util/helper"),r=e("hgn!template/addThisEvent");(function(e){function a(e,t,n){var r,i=[],s=n.get("lessons")[e][t.index];i.push("<b>GROUP: </b>"+t.classNo),i.push("<b>TYPE: </b>"+t.type),i.push("<b>WEEK: </b>"+t.weekType);for(r=0;r<s.length;r++)r===0?i.push("<b>TIME: </b>"+s[r].weekDay.slice(0,3)+" "+s[r].startTime+"-"+s[r].endTime):i.push("<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>"+s[r].weekDay.slice(0,3)+" "+s[r].startTime+"-"+s[r].endTime);return i.push("<b>ROOM: </b>"+t.room),i.join("<br>")}function f(e,t){return r({slot:e,module:t.data,time:l(e)})}function l(e){var t=n.getWeekOneDateOfWeekday(e.weekDay),r=parseInt(e.startTime,10),i=parseInt(e.endTime,10),s=new Date(t),o=new Date(t);return s.setHours(r/100),s.setMinutes(r%100),o.setHours(i/100),o.setMinutes(i%100),{startDateTime:n.getDateFormatted(s),endDateTime:n.getDateFormatted(o)}}function c(e,t,n){e==="location"?t.text(n.room):e==="group"?t.text(n.classNo):e==="week"&&t.text(n.weekType)}var t="planner_",i="slot",s=e("#tt-grid"),o=e("#basket-scroll"),u=function(t,n){this.$elem=e(t),this.init(n)};u.prototype={constructor:u,init:function(e){this.$info=this.$elem.find(".opt-info"),this.code=e.code,this.type=e.type,this.slot=e.slot,this.data=e.module,this.id=this.$elem.attr("id"),this.sid=this.id.substr(0,this.id.lastIndexOf("-")),this.updateElem(),this.attachPopover(),this.attachEvents(e.droppable),this.attachDragDrop(e.droppable)},get:function(e){return this.data.get(e)},updateElem:function(){var t=this;this.$elem.data("span")<3&&this.code.length>7&&(this.$elem.addClass("small"),e.subscribe("app:fullsize",function(e,n){n?t.$elem.removeClass("small"):t.$elem.addClass("small")})),planner.slotType!=="location"&&c(planner.slotType,t.$info,t.slot),e.subscribe("app:slotType",function(){c(planner.slotType,t.$info,t.slot),t.$elem.find(".addthisevent-drop").remove()}),e.subscribe("module:calendar",function(){t.$elem.find(".addthisevent-drop").length===0&&t.$elem.find("p").prepend(f(t.slot,t.data))})},attachPopover:function(){function n(e){e?t.$elem.popover({html:!0,trigger:"hover",placement:t.$elem.data("offset")+t.$elem.data("span")>24?"left":"right",title:t.get("code")+" "+t.get("title"),content:a(t.type,t.slot,t.data)}):t.$elem.popover("destroy")}var t=this;n(planner.slotPopover),e.subscribe("app:slotPopover",function(){n(planner.slotPopover)})},attachEvents:function(t){var n=this;if(t)return;this.$elem.on("mouseenter",function(){n.$elem.hasClass("on-dragging")||(s.find(".slot[id^="+n.code+"-]").addClass("hover"),o.find(".module[id="+n.code+"]").addClass("hover"))}),this.$elem.on("mouseleave",function(){s.find(".slot[id^="+n.code+"-]").removeClass("hover"),o.find(".module[id="+n.code+"]").removeClass("hover")}),this.$elem.on("click",function(t){if(e(t.target).hasClass("addthisevent-drop"))return;var r=e("#metro-pivot").data("controller"),i=r.headers.children(".current").text();i==="Modules"?(e.publish("module:detail",n.data),r.goToItemByName("Detail")):e("#detail").data("module")===n.code?r.goToItemByName("Modules"):(e.publish("module:detail",n.data),r.goToItemByName("Detail"))})},attachDragDrop:function(t){var n=this;this.dragOpts={helper:"clone",opacity:.3,cursorAt:{top:20,left:20},revert:"invalid",revertDuration:200,zIndex:1e3,start:e.proxy(n.dragStart,n),stop:e.proxy(n.dragStop,n)},this.dropOpts={activeClass:"highlight",hoverClass:"hover",tolerance:"pointer",over:e.proxy(n.dropOver,n),out:e.proxy(n.dropOut,n),drop:e.proxy(n.dropEvent,n)},t?this.$elem.droppable(this.dropOpts):this.data.count(this.type)>1?this.$elem.draggable(this.dragOpts):this.$elem.addClass("nomove")},dragStart:function(){s.find(".slot[id^="+this.sid+"-]").addClass("on-dragging"),e.publish("grid:module:droppable",[this.slot,this.type,this.data])},dragStop:function(){s.find(".slot[id^="+this.sid+"-]").removeClass("on-dragging"),s.find(".ui-droppable").remove(),e.publish("grid:rows:clearEmpty")},dropEvent:function(t,n){this.$elem.trigger("mouseleave"),n.helper.remove(),s.find(".slot[id^="+this.code+"-"+this.type+"-][data-type="+this.type+"]").remove(),e.publish("grid:module:allocate",[this.slot,this.type,this.data]),setTimeout(function(){e.publish("grid:rows:clearEmpty")},10)},dropOver:function(){s.find(".slot[id^="+this.sid+"-]").addClass("hover"),this.$elem.popover("show")},dropOut:function(){s.find(".slot[id^="+this.sid+"-]").removeClass("hover"),this.$elem.popover("hide")}},e.fn.slot=function(n){return this.each(function(){e.data(this,t+i)||e.data(this,t+i,new u(this,n))})}})(jQuery)}),define("hgn!template/timeSlot",["hogan"],function(e){var t=new e.Template(function(e,t,n){var r=this;return r.b(n=n||""),r.b('<div id="'),r.b(r.v(r.f("code",e,t,0))),r.b("-"),r.b(r.v(r.f("type",e,t,0))),r.b("-"),r.b(r.v(r.d("slot.index",e,t,0))),r.b("-"),r.b(r.v(r.f("index",e,t,0))),r.b('"'),r.b("\n"+n),r.b('    class="grid slot '),r.b(r.v(r.f("type",e,t,0))),r.b(" offset"),r.b(r.v(r.f("offset",e,t,0))),r.b(" span"),r.b(r.v(r.f("span",e,t,0))),r.b('"'),r.b("\n"+n),r.b('    style="background-color:'),r.b(r.v(r.d("data.color",e,t,0))),r.b('"'),r.b("\n"+n),r.b('    data-id="'),r.b(r.v(r.f("code",e,t,0))),r.b('" data-type="'),r.b(r.v(r.f("type",e,t,0))),r.b('"'),r.b("\n"+n),r.b('    data-offset="'),r.b(r.v(r.f("offset",e,t,0))),r.b('" data-span="'),r.b(r.v(r.f("span",e,t,0))),r.b('">'),r.b("\n"+n),r.b("    <p>"),r.b(r.v(r.f("code",e,t,0))),r.b(" "),r.b(r.v(r.f("shortType",e,t,0))),r.b('<br/><span class="opt-info">'),r.b(r.v(r.d("slot.room",e,t,0))),r.b("</span></p>"),r.b("\n"+n),r.b("</div>"),r.b("\n"),r.fl()},"",e);return function(){return t.render.apply(t,arguments)}}),define("view/weekdayView",["require","exports","module","helper/jquery.slot","hgn!template/timeSlot"],function(e,t){function r(e){this.name=e,this.$elem=$("#"+this.name.toLowerCase()),this.$rows=[];var t,n,r=this.$elem.find(".row-fluid");for(t=0,n=r.length;t<n;t++)this.$rows.push($(r[t]));this.occupied=[],this.$occupied=this.$rows[0],this.$occupied.on("dblclick",".span1",$.proxy(this.toggleOccupiedSpan,this)),$.subscribe("grid:rows:clearEmpty",$.proxy(this.compressRows,this))}function i(e,t,n){var r,i=e.length,o;for(r=0;r<i;r++){o=$(e[r]);if(s(o.data("offset"),o.data("span"),t,n))return!0}}function s(e,t,n,r){var i=e+t,s=n+r;return n>=e&&n<i?!0:s>e&&s<=i?!0:n<=e&&s>=i?!0:!1}function o(e){return e=parseInt(e,10),2+(Math.floor(e/100)-8)*2+(e%100?1:0)}function u(e){var t=e.toUpperCase().split("-");return t[0].indexOf("LAB")>=0?"(LB)":t.length===3?"("+t[0].charAt(0)+t[2].charAt(0)+")":t.length===2?"("+t[0].charAt(0)+t[1].charAt(0)+")":"("+t[0].charAt(0)+")"}function a(e){var t=$(n(e));return t.slot(e),t}e("helper/jquery.slot");var n=e("hgn!template/timeSlot");return r.fn=r.prototype,r.fn.allocate=function(e,t,n,r,i){var s=o(t.startTime),f=o(t.endTime)-s,l=this.hasEmptySlots(s,f);l===-1&&(this.createNewRow(),l=this.$rows.length-1);var c={code:r.get("code"),type:n,shortType:u(t.type),index:e,offset:s,span:f,slot:t,data:r.data,module:r,droppable:i||!1};this.$rows[l].append(a(c)),this.$elem.hasClass("hidden")&&(this.$elem.removeClass("hidden"),$(window).resize())},r.fn.createNewRow=function(){var e=this.$rows[1].clone();e.find(".slot").remove(),this.$rows.push(e),this.$elem.append(e),$(window).resize()},r.fn.compressRows=function(){this.removeEmptyRows(),this.$rows[0].find(".slot, .occupied").length>0?this.mergeRows():this.name==="SATURDAY"&&this.$elem.addClass("hidden"),$(window).resize()},r.fn.removeEmptyRows=function(){var e,t;for(e=this.$rows.length-1;e>1;e--)this.$rows[e].find(".slot").length===0&&(this.$rows[e].remove(),this.$rows.splice(e,1));this.$rows[0].find(".slot, .occupied").length===0&&(e=this.$rows.length===2?1:2,t=this.$rows[e].find(".slot").detach(),this.$rows[0].append(t),e===2&&(this.$rows[2].remove(),this.$rows.splice(e,1))),this.$rows[1].find(".slot").length===0&&this.$rows.length>2&&(t=this.$rows[2].find(".slot").detach(),this.$rows[1].append(t),this.$rows[2].remove(),this.$rows.splice(2,1))},r.fn.mergeRows=function(){var e,t,n,r,i,s;for(e=this.$rows.length-1;e>0;e--){i=this.$rows[e].find(".slot");for(t=i.length-1,n=0;t>=0;t--)s=$(i[t]),r=this._hasEmptySlots(s.data("offset"),s.data("span"),e),r!==-1&&(s.detach(),this.$rows[r].append(s),n++);n!==0&&e!==1&&n===i.length&&(this.$rows[e].remove(),this.$rows.splice(e,1))}},r.fn._hasEmptySlots=function(e,t,n){var r,s,o,u,a,f;for(s=0;s<n;s++){r=!0;if(i(this.$rows[s].find(".slot"),e,t))continue;if(s===0&&i(this.$occupied.find(".occupied"),e,t))continue;if(r)return s}return-1},r.fn.hasEmptySlots=function(e,t){return this._hasEmptySlots(e,t,this.$rows.length)},r.fn.toggleOccupiedSpan=function(e){var t=$(e.currentTarget);t.hasClass("slot")||this._toggleOccupiedGrid(t.find(".grid"),t.index()+1,!0)},r.fn._toggleOccupiedGrid=function(e,t,n){e.toggleClass("occupied"),e.hasClass("occupied")?e.data({offset:t,span:1}):i(this.$rows[1].find(".slot"),t,1)&&this.compressRows(),n&&$.publish("grid:occupy:save",[this.name])},r.fn.addOccupiedSlots=function(e){var t,n,r=this.$occupied.find(".grid");for(t=0;n=e[t];t++)this._toggleOccupiedGrid($(r[n-1]),n)},r.fn.getOccupiedSlots=function(){var e=[],t,n,r=this.$occupied.find(".occupied");for(t=0,n=r.length;t<n;t++)e.push($.data(r[t],"offset"));return e},r}),define("view/plannerView",["require","exports","module","view/weekdayView","util/helper","util/store"],function(e,t){function o(){var e,t=i.get("grid:occupied");if(t)for(e in t)t.hasOwnProperty(e)&&s[e].addOccupiedSlots(t[e])}function u(e,t,n){var r=e.index,i=n.get("lessons")[t][r];f(i,t,n),n.allocate(t,r)}function a(e){var t,n,i,o,u;t=!0;for(n=0,i=e.length;n<i;n++){o=r.getTimeIndex(e[n].startTime),u=r.getTimeIndex(e[n].endTime)-o;if(s[e[n].weekDay].hasEmptySlots(o,u)!==0){t=!1;break}}return t}function f(e,t,n,r){var i,o;for(i=0,o=e.length;i<o;i++)s[e[i].weekDay].allocate(i,e[i],t,n,r)}var n=e("view/weekdayView"),r=e("util/helper"),i=e("util/store"),s={};t.init=function(){var e,t=planner.weekDays.length;for(e=0;e<t;e++)s[planner.weekDays[e]]=new n(planner.weekDays[e]);o(),$("#tt-grid").on("contextmenu",function(e){e.preventDefault()})},$.subscribe("grid:occupy:allocate",function(e,t,n){s[t].addOccupiedSlots(n)}),$.subscribe("grid:occupy:save",function(e,t){var n=i.get("grid:occupied")||{};n[t]=s[t].getOccupiedSlots(),i.set("grid:occupied",n)}),$.subscribe("grid:module:droppable",function(e,t,n,r){var i=t.index,s=r.get("lessons")[n],o;for(o in s)s.hasOwnProperty(o)&&o!==i&&f(s[o],n,r,!0)}),$.subscribe("grid:refresh",function(){var e,t=planner.weekDays.length;for(e=0;e<t;e++)s[planner.weekDays[e]].compressRows()}),$.subscribe("grid:module:allocate",function(e,t,n,r){u(t,n,r)}),$.subscribe("grid:module:reallocate",function(e,t){var n,r=t.get("lessons"),i;for(n in r)r.hasOwnProperty(n)&&(i=t.allocated(n),i&&u(r[n][i][0],n,t))}),$.subscribe(planner.list.modules+":addOne",function(e,t){if(!t.is("visible"))return;var n,r=t.get("lessons"),i,s,o;for(n in r)if(r.hasOwnProperty(n))if(t.allocated(n))s=r[n][t.allocated(n)],f(s,n,t),t.allocate(n,s[0].index);else{i=!1,s=r[n];for(o in s)if(s.hasOwnProperty(o)&&a(s[o])){f(s[o],n,t),t.allocate(n,o),i=!0;break}i||(o=Object.keys(s)[0],f(s[o],n,t),t.allocate(n,o))}})}),define("view/appView",["require","exports","module","view/schoolView","view/addModuleView","view/basketView","view/detailView","view/messageView","view/shareView","view/plannerView"],function(e,t){function f(){$("#nav").tooltip({placement:"bottom",selector:"a[rel=tooltip]"}),$("#misc-btns").tooltip({placement:"bottom",selector:"a[rel=tooltip]"}),$("#footer").tooltip({placement:"top",selector:"a[rel=tooltip]"}),$("#version").text(planner.version),$("#planner").css("min-height",$("#primary").height()),$(window).bind("resize",function(e){var t=$(this).height(),n=$("#primary").height(),r=t>n?t:n;$("#sidebar").height(r),$("#metro-pivot").find(".pivotItem").height(r-168),$.publish("app:window:resize",[r,$(this).width()])}).trigger("resize"),$("#fullsize").on("click",function(){var e=!1;return function(){$.publish("app:fullsize",e=!e)}}()),$(".share-btn").on("click",function(e){if(!e)return;e.preventDefault(),window.open(e.target.href,"intent","scrollbars=yes,resizable=yes,toolbar=no,location=yes,width=550,height=420,left="+(window.screen?Math.round(screen.width/2-275):50)+",top="+100)})}var n=e("view/schoolView"),r=e("view/addModuleView"),i=e("view/basketView"),s=e("view/detailView"),o=e("view/messageView"),u=e("view/shareView"),a=e("view/plannerView");t.init=function(){u.init(),n.init(),r.init(),a.init(),i.init(),s.init(),o.init(),f()},$.subscribe("app:fullsize",function(e,t){var n=$("#primary"),r=$("#secondary");t?(r.hide(),n.removeClass("span26").addClass("offset1 span32")):(r.show(),n.removeClass("offset1 span32").addClass("span26")),$(window).resize(),planner.trackEvent("toggle-fullsize",t)})}),define("appMain",["require","exports","module","plugin/bootstrap","plugin/jquery.metro","util/pubsub","util/store","controller/modulesController","view/appView"],function(e,t){function s(){var e=n.get("version");n.set("version",planner.version),$.publish("app:status:"+(e?e<planner.version?"updated":"uptodate":"new"))}function o(){$(document).on("click","a",function(e){e.currentTarget.hostname==="cors.bicrement.com"||planner.trackPageView(e.currentTarget.href,"outbound")})}function u(){addthisevent.settings({mouse:!1,css:!1,dropdown:!1,outlook:{show:!1,text:"Outlook Calendar"},google:{show:!1,text:"Google Calendar"},yahoo:{show:!1,text:"Yahoo Calendar"},hotmail:{show:!1,text:"Hotmail Calendar"},ical:{show:!1,text:"iCal Calendar"},facebook:{show:!1,text:"Facebook Event"},callback:""})}e("plugin/bootstrap"),e("plugin/jquery.metro"),e("util/pubsub");var n=e("util/store"),r=e("controller/modulesController"),i=e("view/appView");t.init=function(e){r.init(),i.init(),s(),o(),u()}}),require.config({baseUrl:"js",paths:{hgn:"libs/requirejs-plugins/hgn",text:"libs/requirejs-plugins/text",hogan:"libs/requirejs-plugins/hogan",plugin:"libs",appMain:"../app/appMain",global:"../app/global",api:"../app/api",model:"../app/models",view:"../app/views",controller:"../app/controllers",helper:"../app/helpers",school:"../schools",util:"utils",template:"../app/templates"},hgn:{templateExtension:".mustache"}}),require(["global","appMain"],function(e,t){$(function(){t.init()})}),define("main",function(){});