define(["require","exports","module"],function(e,t){function l(e){return typeof e=="object"&&(e=JSON.stringify(e)),e?e.replace(a,"").replace(f,""):""}function c(e){return e&&e.query&&e.query.results&&e.query.results.table?!0:!1}function h(e){return e.query.count!==2}function p(e){return!/currently not available/i.test(JSON.stringify(e))}function d(e){var t=/Correct as at (\d\d \w{3} \d{4} \d\d:\d\d)\"/.exec(JSON.stringify(e));n.correctAsAt=t?t[1]:undefined}function v(e){var t=1,r;for(r in s)s.hasOwnProperty(r)&&(n[r]=s[r](e[t++].td[1]))}function m(e){return!/No Lecture Class/i.test(JSON.stringify(e))}function g(e){return!/No Tutorial Class or to be announced/i.test(JSON.stringify(e))}function y(e){var t=n.lessons,r,i,s,a,f,l,c=e.length;for(a=1;a<c;a++)if(e[a].td&&e[a].td.length>=o){r=u.type(e[a].td[1]).toLowerCase(),t[r]||(t[r]={}),s={},f=0;for(l in u)u.hasOwnProperty(l)&&(s[l]=u[l](e[a].td[f++]));i=s.classNo,t[r][i]||(t[r][i]=[]),s.parent=r,s.index=i,t[r][i].push(s)}}var n,r=function(e){return e.p?e.p:l(e)},i=function(e){var t=e.content||e.p;if(typeof t=="object")return i(t);if(typeof t=="string")return l(t);throw"ERROR PARSE FAILED: "+JSON.stringify(e).substr(0,10)},s={code:function(e){return r(e).split(" ")[0]},title:r,description:r,examinable:r,examDate:i,credits:function(e){return parseInt(e.p,10)},prerequisite:r,preclusion:r,workload:r},o=7,u={classNo:r,type:function(e){return(e.p?e.p:l(e)).replace(/\s/g,"-")},weekType:r,weekDay:r,startTime:r,endTime:r,room:i},a=/^\s+/,f=/(,?)\s+$/;t.tryParse=function(e){return c(e)&&p(e.query.results.table[1].tr[1])},t.parse=function(e){if(!c(e))return null;if(!h(e))throw new Error("NUS CORS Module Website is Down.");var t=e.query.results.table;return n={},n.url=e.url,p(t[1].tr[1])?(n.isAvailable=!0,d(t[1].tr[0]),v(t[2].tr),n.lessons={},m(t[3].tr)&&y(t[4].tr),g(t[5].tr)&&(y(t[5].tr),y(t[6].tr))):n.isAvailable=!1,n}});